<?phprequire_once("./inc/connect_db.php");// this file returns an xml file that confirms that the email address is updated and they agreement number the borrower has signed$y = true;$do_email = false;$agreement_id = addslashes($agreement_id);$student_id = addslashes($student_id);$other_email = addslashes($other_email);if ($y) {	header("Content-type: text/xml");		print("<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>	<data>	");		$query = "SELECT asset_description, notes	FROM assets	GROUP BY asset_description	ORDER BY asset_description ";	$mysql_result = mysql_query($query, $mysql_link);	while($row = mysql_fetch_row($mysql_result)) {		$assets_asset_description = stripslashes($row[0]);		$assets_notes = htmlspecialchars(stripslashes($row[1]));				$assets_asset_description2 = addslashes($assets_asset_description);		$assets_count = 0;				// Get total amount of this product		$query2 = "SELECT COUNT(id)		FROM assets		WHERE asset_description = '$assets_asset_description2' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$assets_count = stripslashes($row2[0]);		}										// Get total amount of this product by active		$query2 = "SELECT COUNT(id)		FROM assets		WHERE asset_description = '$assets_asset_description2' 		AND actions_id  = '1' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$active = stripslashes($row2[0]);		}				// Get total amount of this product by lost		$query2 = "SELECT COUNT(id)		FROM assets		WHERE asset_description = '$assets_asset_description2' 		AND actions_id  = '2' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$lost = stripslashes($row2[0]);		}				// Get total amount of this product by repair		$query2 = "SELECT COUNT(id)		FROM assets		WHERE asset_description = '$assets_asset_description2' 		AND actions_id  = '3' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$repair = stripslashes($row2[0]);		}				// Get total amount of this product by retired		$query2 = "SELECT COUNT(id)		FROM assets		WHERE asset_description = '$assets_asset_description2' 		AND actions_id  = '4' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$retired = stripslashes($row2[0]);		}				// Get total amount of this product by donotdisplay		$query2 = "SELECT COUNT(id)		FROM assets		WHERE asset_description = '$assets_asset_description2' 		AND actions_id  = '5' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$donotdisplay = stripslashes($row2[0]);		}																// Get total temporarily booked by students (prior to offical check out by staff)		$query2 = "SELECT COUNT(assets_description)		FROM assets_bin		WHERE assets_description = '$assets_asset_description2' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$assets_bin_count = stripslashes($row2[0]);		}				// Get total in reserve for this product		$assets_reserve = 0;				$query2 = "SELECT reserve		FROM assets_reserve		WHERE asset_description = '$assets_asset_description2' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$assets_reserve = stripslashes($row2[0]);		}				// Get how many have been already signed out for this product		//unset($assets_list);		$signed_out = 0;				$query2 = "SELECT id		FROM assets		WHERE asset_description = '$assets_asset_description2' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$assets_id = stripslashes($row2[0]);						//$x = 0;						$query3 = "SELECT count(assets_id)			FROM assets_logged_out			WHERE in_time = '0'			AND assets_id = '$assets_id' ";			$mysql_result3 = mysql_query($query3, $mysql_link);			while($row3 = mysql_fetch_row($mysql_result3)) {				if ($row3[0] > 0)				{			        $signed_out++;				}			}			/*if ($x == 1) {				//$assets_list[$assets_id] = $assets_id;				++$signed_out;			} */		}				// Derive total available from above numbers		$assets_count_available = $active - $assets_reserve - $signed_out;		if ($assets_count_available < 0) {			$assets_count_available = 0;		}				$assets_asset_description2 = addslashes($assets_asset_description);				$query2 = "SELECT categories_id		FROM assets		WHERE asset_description = '$assets_asset_description2'		AND categories_id != '0' ";		//print("$query2<br /.");		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$assets_categories_id = addslashes($row2[0]);;		}				$query2 = "SELECT name		FROM categories		WHERE id = '$assets_categories_id' ";		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$categories_name = addslashes($row2[0]);;		}				unset($scan_count);		$query2 = "SELECT inventory.scan_date		FROM assets, inventory		WHERE assets.id = inventory.assets_id		AND assets.asset_description = '$assets_asset_description2' 		GROUP BY assets.id ";		//print("$query2<br />");		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			++$scan_count;		}								print("<asset_types>		<asset_description>$assets_asset_description</asset_description>		<assets_count>$assets_count</assets_count>		<assets_reserve>$assets_reserve</assets_reserve>		<assets_bin>$assets_bin_count</assets_bin>		<signed_out>$signed_out</signed_out>		<assets_count_available>$assets_count_available</assets_count_available>		<image>$image</image>		<categories_id>$assets_categories_id</categories_id>		<categories_name>$categories_name</categories_name>		<notes>$assets_notes</notes>		<active>$active</active>		<lost>$lost</lost>		<repair>$repair</repair>		<retired>$retired</retired>		<donotdisplay>$donotdisplay</donotdisplay>		<scan_count>$scan_count</scan_count>		</asset_types>		");			}	print("</data>	");	} else {	// send no access allowed	header("Content-type: text/xml");	print("<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>	<data>		<student_id>$student_id</student_id>		<error>Update Failed!</error>	</data>	");}$dbh = null;?>