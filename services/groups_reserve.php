<?phprequire_once("./inc/connect_db.php");// this file returns an xml file that confirms that the email address is updated and they agreement number the borrower has signed$assets_description = addslashes($assets_description);$y = true;// check that records are there for all programs and yearsif ($name && $id) {	$name = addslashes($name);	$query = "UPDATE groups	SET name = '$name'	WHERE id = '$id' ";	//print("$query<br />");	$mysql_result = mysql_query($query, $mysql_link);}if ($newGR && $order) {			$query = "DELETE FROM groups_reserve	WHERE assets_description = '$assets_description' ";	$mysql_result = mysql_query($query, $mysql_link);				//print("$query<br />");		//print("GOT HERE<br />");	$orders_array = split(":",$order);	$x=1;	while (list($key) = each($orders_array)) {		$y = $key+1;				$query = "INSERT INTO groups_reserve		SET assets_description = '$assets_description', 		groups_id = '$orders_array[$key]' ";		//print("$query<br />");		$mysql_result = mysql_query($query, $mysql_link);	}}if ($newGR) {	header("Content-type: text/xml");			print("<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>	<groups_reserve>	");		$student_id = addslashes($student_id);		$total = 0;	$query = "SELECT groups.id, groups.name, groups.programs_id, groups.year	FROM groups, groups_reserve	WHERE groups.id = groups_reserve.groups_id	AND groups_reserve.assets_description = '$assets_description'	ORDER BY groups.name";	//print("$query<br />");	$mysql_result = mysql_query($query, $mysql_link);	while($row = mysql_fetch_row($mysql_result)) {		$groups_id = stripslashes($row[0]);		$groups_name = htmlspecialchars(stripslashes($row[1]));		$groups_programs_id = htmlspecialchars(stripslashes($row[2]));		$groups_year = htmlspecialchars(stripslashes($row[3]));				unset($programs_name);		$query2 = "SELECT name		FROM programs		WHERE id = '$groups_programs_id' ";		//print("$query<br />");		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$programs_name = stripslashes($row2[0]);		}				print("<group>		<id>$groups_id</id>		<name>$groups_name</name>		<program_name>$programs_name</program_name>		<program_id>$groups_programs_id</program_id>		<year>$groups_year</year>		</group>		");	}	print("</groups_reserve>	");	} elseif ($y) {	header("Content-type: text/xml");		print("<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>	<groups_reserve>	");		$student_id = addslashes($student_id);		$total = 0;	$query = "SELECT groups.id, groups.name, groups.programs_id, groups.year	FROM groups	ORDER BY groups.year, groups.name, groups.programs_id";	//print("$query<br />");	$mysql_result = mysql_query($query, $mysql_link);	while($row = mysql_fetch_row($mysql_result)) {		$groups_id = stripslashes($row[0]);		$groups_name = htmlspecialchars(stripslashes($row[1]));		$groups_programs_id = htmlspecialchars(stripslashes($row[2]));		$groups_year = htmlspecialchars(stripslashes($row[3]));				unset($groups_reserve_id);		$query2 = "SELECT id		FROM groups_reserve		WHERE assets_description = '$assets_description' 		AND groups_id = '$groups_id' ";		//print("$query<br />");		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$groups_reserve_id = stripslashes($row2[0]);		}								unset($programs_name);		$query2 = "SELECT name		FROM programs		WHERE id = '$groups_programs_id' ";		//print("$query<br />");		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$programs_name = stripslashes($row2[0]);		}				if (empty($groups_reserve_id)) {			print("<group>			<id>$groups_id</id>			<name>$groups_name</name>			<program_name>$programs_name</program_name>			<program_id>$groups_programs_id</program_id>			<year>$groups_year</year>			</group>			");		}	}		/*	print("<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>	<groups_reserve>	");		$student_id = addslashes($student_id);		$total = 0;	$query = "SELECT groups.id, groups.name, groups.programs_id, groups.year, groups_reserve.groups_id	FROM groups LEFT JOIN groups_reserve	ON groups.id = groups_reserve.groups_id	ORDER BY groups.year DESC, groups.name, groups.programs_id";	//print("$query<br />");	$mysql_result = mysql_query($query, $mysql_link);	while($row = mysql_fetch_row($mysql_result)) {		$groups_id = stripslashes($row[0]);		$groups_name = htmlspecialchars(stripslashes($row[1]));		$groups_programs_id = htmlspecialchars(stripslashes($row[2]));		$groups_year = htmlspecialchars(stripslashes($row[3]));		$groups_reserve_groups_id = htmlspecialchars(stripslashes($row[4]));				unset($programs_name);		$query2 = "SELECT name		FROM programs		WHERE id = '$groups_programs_id' ";		//print("$query<br />");		$mysql_result2 = mysql_query($query2, $mysql_link);		while($row2 = mysql_fetch_row($mysql_result2)) {			$programs_name = stripslashes($row2[0]);		}				if (empty($groups_reserve_groups_id)) {			print("<group>			<id>$groups_id</id>			<name>$groups_name</name>			<program_name>$programs_name</program_name>			<program_id>$groups_programs_id</program_id>			<year>$groups_year</year>			</group>			");		}	}	*/	print("</groups_reserve>	");} else {	// send no access allowed	header("Content-type: text/xml");	print("<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>	<data>				");		print("<asset_types>		<student_id>$student_id</student_id>		<error>Update Failed!</error>		<asset_description>$assets_asset_description</asset_description>		<assets_notes>$assets_notes</assets_notes>		<assets_serial_number>$assets_serial_number</assets_serial_number>		<assets_barcode>$assets_barcode</assets_barcode>		<assets_logged_out_out_time>$assets_logged_out_out_time</assets_logged_out_out_time>		<assets_logged_out_due_time>$assets_logged_out_due_time</assets_logged_out_due_time>		<assets_logged_out_in_time>$assets_logged_out_in_time</assets_logged_out_in_time>		<borrowers_first_name>$borrowers_first_name</borrowers_first_name>		<borrowers_last_name>$borrowers_last_name</borrowers_last_name>		<borrowers_student_id>$borrowers_student_id</borrowers_student_id>		<borrowers_dc_email>$borrowers_dc_email</borrowers_dc_email>		<borrowers_other_email>$borrowers_other_email</borrowers_other_email>		<overdue>$overdue</overdue>		</asset_types>		");	print("</data>	");}?>